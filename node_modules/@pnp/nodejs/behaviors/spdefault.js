import { combine, isUrlAbsolute } from "@pnp/core";
import { DefaultParse } from "@pnp/queryable";
import { DefaultHeaders, DefaultInit } from "@pnp/sp";
import { NodeFetchWithRetry } from "./fetch.js";
import { MSAL } from "./msal.js";
/**
 * Behavior for adding the default observers to the SP queryable object
 * @param props - Specify the ISPDefaultProps for configuring the object
 *        props.msal: (deprecated, use separate MSAL behavior)
 */
export function SPDefault(props) {
    if ((props === null || props === void 0 ? void 0 : props.baseUrl) && !isUrlAbsolute(props === null || props === void 0 ? void 0 : props.baseUrl)) {
        throw Error("SPDefault props.baseUrl must be absolute when supplied.");
    }
    return (instance) => {
        const behaviors = [DefaultHeaders(), DefaultInit(), NodeFetchWithRetry(), DefaultParse()];
        if (props === null || props === void 0 ? void 0 : props.msal) {
            behaviors.push(MSAL(props.msal.config, props.msal.scopes));
        }
        instance.using(...behaviors);
        instance.on.pre.prepend(async (url, init, result) => {
            if (!isUrlAbsolute(url)) {
                url = combine(props === null || props === void 0 ? void 0 : props.baseUrl, url);
            }
            return [url, init, result];
        });
        return instance;
    };
}
//# sourceMappingURL=spdefault.js.map